# Story 2.1: Bootstrap & Service Locator Refactoring

**Status**: InProgress
**Role**: Developer
**Epic**: 2 (Bootstrap & State Management Modularization)

## Description
Refactor the global nullable instances in `bootstrap.dart` into Riverpod providers. This involves creating a set of providers for core infrastructure services and ensuring they are correctly initialized and injected during the app's bootstrap process.

## Story
**As a** developer/maintainer,
**I want** to replace global mutable state in the bootstrap layer with Riverpod providers,
**so that** the application has a single source of truth for service instances and is easier to test.

## Acceptance Criteria
- [ ] `globalConnectivityService` is replaced by `connectivityServiceProvider`.
- [ ] `globalSyncManager` is replaced by `syncManagerProvider`.
- [ ] `globalRealtimeSyncService` and `globalModuleRealtimeSyncService` are replaced by appropriate providers.
- [ ] `globalMessagingService` is replaced by `messagingServiceProvider`.
- [ ] `bootstrap()` initializes these services and provides them to the app root.
- [ ] No regression in application startup or core functionality (Sync, Connectivity).

## Tasks / Subtasks
- [ ] Create `lib/core/offline/providers.dart` to define core infrastructure providers.
- [ ] Refactor `lib/app/bootstrap.dart` to remove global variables and initialize providers.
- [ ] Update `lib/main.dart` to handle provider overrides if necessary.
- [ ] Update call sites of the old global variables throughout the project.
- [ ] Verify stabilization with `flutter analyze` and `flutter test`.

## Dev Notes
- **Relevant Files**:
  - [lib/app/bootstrap.dart](file:///home/carlos-simpore/StudioProjects/elyf_group_app/lib/app/bootstrap.dart)
  - [lib/main.dart](file:///home/carlos-simpore/StudioProjects/elyf_group_app/lib/main.dart)
  - [lib/core/offline/sync_manager.dart](file:///home/carlos-simpore/StudioProjects/elyf_group_app/lib/core/offline/sync_manager.dart)
- **Architecture Reference**:
  - [State Management](file:///home/carlos-simpore/StudioProjects/elyf_group_app/docs/architecture/state-management.md)
  - [Bootstrap wiring](file:///home/carlos-simpore/StudioProjects/elyf_group_app/docs/architecture/vue-d-ensemble.md)

## Testing
- Ensure `flutter analyze` passes.
- Mock the core services in a test to verify injection works as expected.

## Change Log
| Date | Version | Description | Author |
| :--- | :--- | :--- | :--- |
| 2026-02-10 | 1.0 | Initial Draft | Antigravity |
