---
id: 2.2-auth-tenant-modularization
title: "Story 2.2: AuthService & TenantProvider Modularization"
status: Draft
epic: 2-bootstrap-modularization
---

# Story 2.2: AuthService & TenantProvider Modularization

## Description
Migrate `AuthService` and `TenantProvider` to use modular dependencies injected via Riverpod. This eliminates the use of `FirebaseFirestore.instance` and `FirebaseAuth.instance` directly within the services and standardizes how `SharedPreferences` is accessed.

## User Review Required
> [!IMPORTANT]
> This change will refactor core providers used throughout the application. While the API should remain mostly compatible, the underlying initialization timing might change slightly (becoming fully reactive via Riverpod).

## Proposed Changes

### Core Infrastructure
#### [MODIFY] [providers.dart](file:///home/carlos-simpore/StudioProjects/elyf_group_app/lib/core/offline/providers.dart)
- [NEW] Add `sharedPreferencesProvider`.

### Auth Module
#### [MODIFY] [auth_service.dart](file:///home/carlos-simpore/StudioProjects/elyf_group_app/lib/core/auth/services/auth_service.dart)
- Update `authServiceProvider` and `firestoreUserServiceProvider` to use core Firebase providers.
- Inject dependencies into `AuthService`, `AuthSessionService`, and `AuthUserService`.

### Tenant Module
#### [MODIFY] [tenant_provider.dart](file:///home/carlos-simpore/StudioProjects/elyf_group_app/lib/core/tenant/tenant_provider.dart)
- Update `ActiveEnterpriseIdNotifier` to use `sharedPreferencesProvider`.
- Remove `ActiveEnterpriseIdManager` static methods in favor of provider-based access.

## Verification Plan

### Automated Tests
- `flutter analyze` to ensure no broken references.
- Unit tests for `AuthService` using mocked Firebase providers.

### Manual Verification
- Verify login/logout flow still works.
- Verify active enterprise persistence (survives app restart).
