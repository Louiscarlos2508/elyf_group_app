# Story 1.3: Documentation and Unit Tests (R3)

**Status**: Done
**Role**: Developer
**Epic**: 1 (Cleanup & Reliability)

## Description
Complete PRD R3: ensure `docs/brownfield-architecture.md` reflects the current state after Stories 1.1 and 1.2, and add unit tests for critical business logic in `features/eau_minerale` and `features/gaz`.

## Story
**As a** developer/maintainer,
**I want** the brownfield architecture doc to be up to date and critical eau_minerale/gaz logic to be covered by unit tests,
**so that** the codebase remains well-documented and regressions in core business logic are caught by tests.

## Acceptance Criteria
- [x] `docs/brownfield-architecture.md` is reviewed and updated to reflect current state after 1.1/1.2 (analysis fixed, sync layer documented).
- [x] At least one unit test (or small set) exists for critical business logic in `features/eau_minerale`.
- [x] At least one unit test (or small set) exists for critical business logic in `features/gaz`.

## Tasks
- [x] Review `docs/brownfield-architecture.md`; apply minor edits if anything is outdated.
- [x] Identify 1–2 critical services or controllers in eau_minerale (e.g. sale service, payment logic) and add corresponding unit tests under `test/features/eau_minerale/`.
- [x] Identify 1–2 critical services or controllers in gaz (e.g. gas sale, cylinder stock) and add corresponding unit tests under `test/features/gaz/`.
- [x] Run `flutter test` and `flutter analyze`; fix any issues.

## Dev Notes
- Reuse existing test patterns: [test/helpers/mock_factories.dart](test/helpers/mock_factories.dart), [test/helpers/test_helpers.dart](test/helpers/test_helpers.dart), and existing controller/repo tests in `test/features/administration/` and `test/features/boutique/` as reference.
- brownfield-architecture was already updated in 1.1 (analysis item) and 1.2 (Sync layer subsection); this story is a final pass and any small corrections.

## Testing
- New tests must pass with `flutter test`.
- No new `flutter analyze` issues.

## Change Log
- (Draft) Story created from PRD R3 and plan "BMAD Next Step – Story 1.3".
- (Done) Reviewed brownfield-architecture.md (already up to date); added implementation priority item for Story 1.3. Added `test/features/eau_minerale/domain/services/credit_service_test.dart` (CreditService: recordPayment validation and happy path). Added `test/features/gaz/domain/services/gas_validation_service_test.dart` (GasValidationService: cylinder, customer name/phone, stock, validateGasSale). All tests pass; flutter analyze 0 issues.
